<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Interactive component | Conditions Contributing to COVID-19 Deaths, by State and Age, Provisional 2020-2022</title>
  <meta name="description" content="Chapter 5 Interactive component | Conditions Contributing to COVID-19 Deaths, by State and Age, Provisional 2020-2022" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Interactive component | Conditions Contributing to COVID-19 Deaths, by State and Age, Provisional 2020-2022" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Interactive component | Conditions Contributing to COVID-19 Deaths, by State and Age, Provisional 2020-2022" />
  
  
  

<meta name="author" content="Jingtian Wang Tongli Su Michelle Sun" />


<meta name="date" content="2022-12-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="results.html"/>
<link rel="next" href="conclusion.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>




<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Covid Death Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="proposal.html"><a href="proposal.html"><i class="fa fa-check"></i><b>2</b> Proposal</a>
<ul>
<li class="chapter" data-level="2.1" data-path="proposal.html"><a href="proposal.html#research-topic"><i class="fa fa-check"></i><b>2.1</b> Research topic</a></li>
<li class="chapter" data-level="2.2" data-path="proposal.html"><a href="proposal.html#data-availability"><i class="fa fa-check"></i><b>2.2</b> Data availability</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>3</b> Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data.html"><a href="data.html#sources"><i class="fa fa-check"></i><b>3.1</b> Sources</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="data.html"><a href="data.html#describe-the-data-cources"><i class="fa fa-check"></i><b>3.1.1</b> Describe the data cources</a></li>
<li class="chapter" data-level="3.1.2" data-path="data.html"><a href="data.html#basic-information-about-the-data"><i class="fa fa-check"></i><b>3.1.2</b> Basic information about the data</a></li>
<li class="chapter" data-level="3.1.3" data-path="data.html"><a href="data.html#issuesproblems-with-the-data"><i class="fa fa-check"></i><b>3.1.3</b> Issues/problems with the data</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data.html"><a href="data.html#cleaning-transformation"><i class="fa fa-check"></i><b>3.2</b> Cleaning / transformation</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data.html"><a href="data.html#graph-1"><i class="fa fa-check"></i><b>3.2.1</b> Graph 1</a></li>
<li class="chapter" data-level="3.2.2" data-path="data.html"><a href="data.html#graph-2"><i class="fa fa-check"></i><b>3.2.2</b> Graph 2</a></li>
<li class="chapter" data-level="3.2.3" data-path="data.html"><a href="data.html#graph-3"><i class="fa fa-check"></i><b>3.2.3</b> Graph 3</a></li>
<li class="chapter" data-level="3.2.4" data-path="data.html"><a href="data.html#graph-4"><i class="fa fa-check"></i><b>3.2.4</b> Graph 4</a></li>
<li class="chapter" data-level="3.2.5" data-path="data.html"><a href="data.html#graph-5"><i class="fa fa-check"></i><b>3.2.5</b> Graph 5</a></li>
<li class="chapter" data-level="3.2.6" data-path="data.html"><a href="data.html#graph-8"><i class="fa fa-check"></i><b>3.2.6</b> Graph 8</a></li>
<li class="chapter" data-level="3.2.7" data-path="data.html"><a href="data.html#graph-9"><i class="fa fa-check"></i><b>3.2.7</b> Graph 9</a></li>
<li class="chapter" data-level="3.2.8" data-path="data.html"><a href="data.html#graph-10"><i class="fa fa-check"></i><b>3.2.8</b> Graph 10</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data.html"><a href="data.html#missing-value-analysis"><i class="fa fa-check"></i><b>3.3</b> Missing value analysis</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>4</b> Results</a>
<ul>
<li class="chapter" data-level="4.1" data-path="results.html"><a href="results.html#graph-1-1"><i class="fa fa-check"></i><b>4.1</b> Graph 1</a></li>
<li class="chapter" data-level="4.2" data-path="results.html"><a href="results.html#graph-2-1"><i class="fa fa-check"></i><b>4.2</b> Graph 2</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="results.html"><a href="results.html#section-16"><i class="fa fa-check"></i><b>4.2.1</b> 2020-2022</a></li>
<li class="chapter" data-level="4.2.2" data-path="results.html"><a href="results.html#section-17"><i class="fa fa-check"></i><b>4.2.2</b> 2020</a></li>
<li class="chapter" data-level="4.2.3" data-path="results.html"><a href="results.html#section-18"><i class="fa fa-check"></i><b>4.2.3</b> 2021</a></li>
<li class="chapter" data-level="4.2.4" data-path="results.html"><a href="results.html#section-19"><i class="fa fa-check"></i><b>4.2.4</b> 2022</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="results.html"><a href="results.html#graph-3-1"><i class="fa fa-check"></i><b>4.3</b> Graph 3</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="results.html"><a href="results.html#section-20"><i class="fa fa-check"></i><b>4.3.1</b> 2020-2022</a></li>
<li class="chapter" data-level="4.3.2" data-path="results.html"><a href="results.html#section-21"><i class="fa fa-check"></i><b>4.3.2</b> 2020</a></li>
<li class="chapter" data-level="4.3.3" data-path="results.html"><a href="results.html#section-22"><i class="fa fa-check"></i><b>4.3.3</b> 2021</a></li>
<li class="chapter" data-level="4.3.4" data-path="results.html"><a href="results.html#section-23"><i class="fa fa-check"></i><b>4.3.4</b> 2022</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="results.html"><a href="results.html#graph-4-1"><i class="fa fa-check"></i><b>4.4</b> Graph 4</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="results.html"><a href="results.html#section-24"><i class="fa fa-check"></i><b>4.4.1</b> 2020-2022</a></li>
<li class="chapter" data-level="4.4.2" data-path="results.html"><a href="results.html#section-25"><i class="fa fa-check"></i><b>4.4.2</b> 2020</a></li>
<li class="chapter" data-level="4.4.3" data-path="results.html"><a href="results.html#section-26"><i class="fa fa-check"></i><b>4.4.3</b> 2021</a></li>
<li class="chapter" data-level="4.4.4" data-path="results.html"><a href="results.html#section-27"><i class="fa fa-check"></i><b>4.4.4</b> 2022</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="results.html"><a href="results.html#graph-5-1"><i class="fa fa-check"></i><b>4.5</b> Graph 5</a></li>
<li class="chapter" data-level="4.6" data-path="results.html"><a href="results.html#graph-6"><i class="fa fa-check"></i><b>4.6</b> Graph 6</a></li>
<li class="chapter" data-level="4.7" data-path="results.html"><a href="results.html#graph-7"><i class="fa fa-check"></i><b>4.7</b> Graph 7</a></li>
<li class="chapter" data-level="4.8" data-path="results.html"><a href="results.html#graph-8-1"><i class="fa fa-check"></i><b>4.8</b> Graph 8</a></li>
<li class="chapter" data-level="4.9" data-path="results.html"><a href="results.html#graph-9-1"><i class="fa fa-check"></i><b>4.9</b> Graph 9</a></li>
<li class="chapter" data-level="4.10" data-path="results.html"><a href="results.html#graph-10-1"><i class="fa fa-check"></i><b>4.10</b> Graph 10</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="interactive-component.html"><a href="interactive-component.html"><i class="fa fa-check"></i><b>5</b> Interactive component</a>
<ul>
<li class="chapter" data-level="5.1" data-path="interactive-component.html"><a href="interactive-component.html#readme"><i class="fa fa-check"></i><b>5.1</b> README</a></li>
<li class="chapter" data-level="5.2" data-path="interactive-component.html"><a href="interactive-component.html#graph"><i class="fa fa-check"></i><b>5.2</b> Graph</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>6</b> Conclusion</a>
<ul>
<li class="chapter" data-level="6.1" data-path="conclusion.html"><a href="conclusion.html#main-takeways-of-our-exploration"><i class="fa fa-check"></i><b>6.1</b> Main takeways of our exploration</a></li>
<li class="chapter" data-level="6.2" data-path="conclusion.html"><a href="conclusion.html#limitations"><i class="fa fa-check"></i><b>6.2</b> Limitations</a></li>
<li class="chapter" data-level="6.3" data-path="conclusion.html"><a href="conclusion.html#future-directions"><i class="fa fa-check"></i><b>6.3</b> Future directions</a></li>
<li class="chapter" data-level="6.4" data-path="conclusion.html"><a href="conclusion.html#lessons-learned"><i class="fa fa-check"></i><b>6.4</b> Lessons learned</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Conditions Contributing to COVID-19 Deaths, by State and Age, Provisional 2020-2022</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="interactive-component" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Interactive component<a href="interactive-component.html#interactive-component" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="readme" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> README<a href="interactive-component.html#readme" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This interactive plot includes death-date curve for each state. By clicking on the target state on the map, its death-date curve will show below. Besides, you can see the state name and its total number of deaths by putting the mouse on the target state for about 1.5s.</p>
</div>
<div id="graph" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Graph<a href="interactive-component.html#graph" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When we build book locally, the graph can be successfully shown but somehow when we access the book by url, it disappears. Therefore, we upload files of interactive part in this link <a href="https://github.com/KenSu223/5702_d3" class="uri">https://github.com/KenSu223/5702_d3</a>. Please follow the README procedure to view the graph.</p>
<html>
<head>
<title>
US Map
</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script type="text/javascript" src="http://d3js.org/d3.v5.js"></script>
<script src="states.js"></script>
<script src="death.js"></script>
<script src="lines.js"></script>
</head>
<body>
<script type="text/javascript">
    var width = 960;
    var height = 500;
    var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height)
        .attr("style", "margin: 20px auto;display: block;")
        .append("g");

    // var projection = d3.geo.albersUsa();
    var projection  = d3.geoAlbersUsa()
    // var path = d3.geo.path()
    var path = d3.geoPath()
        .projection(projection);
    var State2Lines = {};;
    drawMap(states,death)
    for(let i = 0;i<lines.length;i++){
        if(!State2Lines[lines[i].State]){
            State2Lines[lines[i].State] = {
                data:[]
            };
        }
        State2Lines[lines[i].State].data.push([lines[i].Date,parseInt(lines[i]['COVID-19 Deaths'])]);
        State2Lines[lines[i].State].maxDeath = parseInt(lines[i].ymax);
    }
    for(let key in State2Lines){
        State2Lines[key].data.sort()
    }

    function drawMap(states, death) {
        
        var State2Death = {};
        console.log(states)
        console.log(death)

        for (let i = death.length - 1; i >= 0; i--) {
            State2Death[death[i].region] = death[i].COVID_19_Deaths
        }
        
        var proMin = d3.min(death, function(d) { return d.COVID_19_Deaths; }),
            proMax = d3.max(death, function(d) { return d.COVID_19_Deaths; });

        var colorScale = d3.scaleLinear().domain([proMin, proMax]).range([0, 1])
        var compute = d3.interpolate('#EE0000', "#FFC079")


        var targetColor = function(target) {
            if(State2Death[target]){
                return compute(colorScale(State2Death[target]));
            }
            return "#F1E3D6";
        }
        svg.selectAll("path")
            .data(states.features)
            .enter().append("path")
            .attr("stroke", "#000")
            .attr("stroke-width", 1)
            .attr("fill", function(d, i) {
                return targetColor(d.properties.name);
            })
            .attr("d", path)
            .style("cursor","pointer")
            .on("mouseover", function(d, i) {
                d3.select(this).attr("fill", "yellow");
                d3.select(this).append("title")
                                .text("State: " + d.properties.name + "\nDeath: "+State2Death[d.properties.name]);
            })
            .on("mouseout", function(d, i) {
                d3.select(this).attr("fill", targetColor(d.properties.name));
                d3.select(this).select("title").remove();
            })
            .on("click",function(d,i){
                console.log(d)
                // lineSvg.remove()
                drawLine(d.properties.name)
            })
 
    }

    var lineSvg = d3.select("body").append("svg").attr("width", 850).attr("height", 550).attr("style", "margin: 20px auto;display: block;")
    
    var lineG = lineSvg.append("g");
    function drawLine(State){
        lineG.remove();
        lineG = lineSvg.append("g");
        
        const parseTime = d3.timeParse("%Y-%m-%d");
        // const parseTime = d3.time.format("%c").parse;
        let data = State2Lines[State].data;
        

        const x = d3.scaleTime()
        // const x = d3.time.scale()
                    .domain(
                        d3.extent(data, function (d) {
                            // console.log(d)
                            return parseTime(d[0]);
                        })
                    )
                    .rangeRound([0, 800]);

        const y = d3.scaleLinear()
        // const y = d3.scale.linear()
                    .domain(
                        d3.extent(data, function (d) {
                            return d[1];
                        })
                    )
                    .rangeRound([500, 0]);

        const line = d3.line()
                        .x(function (d) {
                            return x(parseTime(d[0]));
                        })
                        .y(function (d) {
                            return y(d[1]);
                        });


        lineG.append("g")
        .attr("transform", "translate(40," + 510 + ")")
        .call(d3.axisBottom(x));

        lineG.append("g")
        .attr("transform", `translate(${40},9)`)
        .call(d3.axisLeft(y))
        .append("text")
        .attr("fill", "#000")
        .attr("transform", "rotate(-90)")
        .attr("y", 6)
        .attr("dy", "0.71em")
        .attr("text-anchor", "end")
        .text("COVID-19 Deaths");


        lineG.append("path")
        .attr("transform", `translate(${40},10)`)
        .datum(data)
        .attr("fill", "none")
        .attr("stroke", "steelblue")
        .attr("stroke-width", 1.5)
        .attr("d", line);
        
        lineG
        .append("g")
        .selectAll("text")
        .data(data)
        .join("text")
        .attr("style","font-size:12px;")
        .attr("transform", d=>`translate(${x(parseTime(d[0]))+20},${y(d[1])+12})`)
        .text(d=>d[1])
    }

    </script>
</body>
</html>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="results.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conclusion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/Chester-JingtianWang/Covid_deaths_analysis/edit/main/interactive.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/Chester-JingtianWang/Covid_deaths_analysis/blob/main/interactive.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
